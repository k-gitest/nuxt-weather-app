## 目的

天気系サービスのexpressとnuxt2へのリプレイスプロジェクトがあったが、
vueがver3になりnuxt3も選択視野となったことから最終的に頓挫する。

気象庁がjsonデータのapi利用を限定的ではあるが許可していた。
折角なので、そのデータを利用し途中までだったnuxt2アプリを作り、読み込み動作を検証する。

## app概要

nuxt2と気象庁jsonデータで構築されたwebアプリケーションプロジェクトです。

気象庁jsonデータにひまわりやナウキャストデータを併用し地理院タイルに表示するアプリケーション開発は以下。
[ひまわりやナウキャストを地理院タイルに表示](https://github.com/k-gitest/weather-leaf-app-prototype)

## 要件

* リアルタイム性を考慮してSSRで開発
* nuxtでapiデータを呼び出し表示する
* api通信はstore（vuex）を使用する
* データの加工は必ずstore内で行いpages内では行わない 
* URIはエリアコードに合わせる
* 天気画像名は天気コードに合わせる
* 簡易地図を設置し主要都市の天気を表示
* 都道府県から市区町村を選択し任意の天気を表示
* 市区町村は都道府県ボタンを押すと開くモーダル内に表示する
* 3日間と7日間を併せて週間天気予報とする
* 信頼度・気温・風・波・降水確率と概況も表示する
* 3日天気と週間天気は同一ページ内に表示する
* 今日の天気の永続化はしない

## 開発環境

* nuxt 2.15.7
* axios 0.24.0
* bootstrap 5.0.0
* sass 1.43.4
* sass-loader 10.1.1
* chart.js 2.9.3

## ディレクトリ構成

<pre>
myapp...プロジェクトディレクトリ
  ├── app ...js設定ファイル
  ├── assets ...アセットファイル
  │     ├── css ...cssファイル 
  │     └── img ...画像ファイル
  ├── components ...表示用コンポーネント
  ├── layouts ...レイアウト用コンポーネント
  ├── pages ...表示用ルートディレクトリ
  ├── plugins ...プラグイン設定ファイル
  └── store ...api呼び出しデータ加工・状態管理
</pre>

### 課題

* 気象庁jsonデータは非公式であるためapiについて何の説明もない
* 開発の前に先ずapiとデータの仕様を解析しなければならない

## ポイント

* 癖のあるデータ設計であるため扱い難い
* 今日の天気予報は値がないので表示したい場合はDBを用意する必要がある
* エリアコードの変更やデータの抜けなども混在しており把握しておく必要がある
* 上記の理由で一部地域だけ特定の処理をする必要がある
* 簡易地図の主要都市天気表示などすると全データを読み込む必要がある
* 「今夜」という画像コードがある
* 前述の理由から処理が膨大になるのでstore内で分割した方が良い
* スクロールが発生するのでrouter.scrollBehavior.jsを使用し、エリアコードのURIを監視し画面遷移するためwatchQueryを使う

## 結論

気象庁の天気予報データが使えると話題になったが、癖のあるデータ設計を見て嫌になる人が多いのも納得だった。

慣れると扱い易いデータ設計だが、解析し慣れるまでの時間の方が開発時間よりも圧倒的に長くなってしまった。

慣れたのでひまわり画像やナウキャストなどのデータと組み合わせたアプリケーションも開発した。そちらのデータも癖があるが先に天気予報データを理解していたので直ぐに慣れた。

癖があるデータなので使用していると直ぐ分かる。有名なところとしてはNHKの気象ページが使用している。

環境問題の高まりから世界各国で気象データを利用したアプリケーションを開発したりapi提供しているので、もしかしたらこの経験が役立つ時がくる･･･かもしれな･･･い
